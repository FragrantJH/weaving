<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReservDAO">

	<insert id="insertReserv" parameterType="reserv">
		INSERT INTO RESERVATION (
							  RESERV_ID,
							  ROOM_ID,
							  EMP_NO,
							  START_TIME,
							  END_TIME,
							  DESCRIPTION
							 
							  
							)
				    VALUES ( 
				             RESERV_SEQ.nextval,
				             #{roomId},
				             #{empNo},
				             to_date(#{startDate},'MM/DD/YYYY HH24:MI'),
				             to_date(#{endDate},'MM/DD/YYYY HH24:MI'),
				             #{description}
				        
				    )			    
	</insert>
	<update id="updateReserv" parameterType="reserv">
		UPDATE RESERVATION
		   SET ROOM_ID = #{roomId},		   	 
		   	   EMP_NO = #{empNo},
		   	   START_TIME = to_date(#{startDate},'MM/DD/YYYY HH24:MI'),
		   	   END_TIME =  to_date(#{endDate},'MM/DD/YYYY HH24:MI'),
		   	   DESCRIPTION = #{description}	   	   
		 WHERE RESERV_ID = #{reservId}
	</update>
	
	<delete id="deleteReserv" parameterType="reserv">
		DELETE FROM RESERVATION
		 WHERE RESERV_ID = #{reservId}
	</delete>
	
	<select id="selectReservList" resultType="reserv">
		SELECT RESERV_ID,
		       ROOM_ID,
			   A.EMP_NO,
               B.EMP_NAME,
			   START_TIME,
			   END_TIME,
			   DESCRIPTION
		  FROM RESERVATION A JOIN EMPLOYEES B ON A.EMP_NO = B.EMP_NO ORDER BY RESERV_ID
		
	</select>
	
	<select id="selectReserv" parameterType="reserv" resultType="reserv">
		SELECT RESERV_ID,
			   ROOM_ID,
			   EMP_NO,
			   START_TIME,
			   END_TIME,	  
			   DESCRIPTION 
		  FROM RESERVATION
		 WHERE RESERV_ID = #{reservId}
	</select>
	
	<select id="selectReservTotalCnt" resultType="int">
		SELECT COUNT(*)
		  FROM RESERVATION
	</select>
	
	<select id="idcheck" parameterType="string" resultType="int">
      SELECT COUNT(*) FROM RESERVATION
      WHERE START_TIME = #{startTime}
	</select>
	
	<!-- 중복체크 -->
	<select id="duplicatecheck" resultType="int">
	select count(*) as duplicateCheck from reservation where to_char(start_time,'yyyy/mm/dd hh24:mi')|| ' '||
to_char(end_time, 'hh24:mi') = #{duplicateCheck} and room_id = #{roomId}
	</select>
	
	
</mapper>