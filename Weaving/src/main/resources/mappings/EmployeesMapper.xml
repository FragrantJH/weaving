<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EmpDAO">
	<insert id="insertEmp" parameterType="emp">
		INSERT INTO EMPLOYEES(
								EMP_NO
								,EMP_NAME
								,PASSWORD
								<if test="position != null">
								,POSITION
								</if><if test="joindate1 != null">
								,JOINDATE
								</if>
								,EMAIL
								<if test="phone != null">
								,PHONE
								</if><if test="address != null">
								,ADDRESS
								</if><if test="deptId != null">
								,DEPT_ID
								</if><if test="deletedYn != null">
								,DELETED_YN
								</if><if test="deletedDate != null">
								,DELETED_DATE
								</if><if test="gmailAppKey != null">
								,GMAIL_APP_KEY
								</if>
								)
		VALUES ( (SELECT NVL(MAX(EMP_NO), 0) + 1 FROM EMPLOYEES )
				,#{empName}
				,#{password}
				<if test="position != null">
				,#{position}
				</if><if test="joindate1 != null">
				,#{joindate1}
				</if>
				,#{email}
				<if test="phone != null">
				,#{phone}
				</if><if test="address != null">
				,#{address}
				</if><if test="deptId != null">
				,#{deptId}
				</if><if test="deletedYn != null">
				,#{deletedYn}
				</if><if test="deletedDate != null">
				,#{deletedDate}
				</if><if test="gmailAppKey != null">
				,#{gmailAppKey}
				</if>
				)
	</insert>
	<!-- 로그인 -->
	<select id ="getEmp" resultType="emp" parameterType="emp">
        select * from employees where emp_no =#{empNo} and password=#{password}
    </select>
    
    <!-- 개인조회 -->
    <select id ="getEmpl" resultType="emp" parameterType="emp">
        select * 
        from employees 
        where emp_no =#{empNo}
    </select>
    
    <!-- 사원 전체 조회 -->
    <select id="getEmpList" resultType="emp" parameterType="emp">
		select e.emp_no, e.emp_name
		,case when position = '0' then '사원'
		when position = '1' then '대리'
		when position = '2' then '과장'
		when position = '3' then '차장'
		when position = '4' then '부장'
        when position = '5' then '대표'
		else '없음' end AS position
		, d.dept_name
		from employees e
		join department d
		on e.dept_id = d.dept_id(+)
		order by e.emp_no desc
	</select>
	
	<!-- 수정 -->
	<update id="updateEmp" parameterType="emp">
		update employees set
		emp_name = #{empName}
		,password = #{password}
		,position = #{position}
		,email = #{email}
		,phone = #{phone}
		,address = #{address}
		,dept_id = #{deptId}
		,gmail_app_key = #{gmailAppKey}
		where emp_no = #{empNo}
	</update>
	
	<!-- 퇴사 -->
	<update id="updateDelEmp" parameterType="emp">
		update employees set deleted_yn = 'Y' ,delete_date=sysdate where emp_no=#{empNo};
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteEmp" parameterType="emp">
		DELETE FROM EMPLOYEES
		WHERE EMP_NO = #{empNo}
	</delete>
</mapper>