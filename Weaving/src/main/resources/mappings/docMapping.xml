<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DocDAO">
	<insert id="insertDoc" parameterType="com.weaving.biz.doc.DocVO">
	<!--
	 INSERT INTO DOCUMENTFORM (
							  FORM_ID,
							  FORM_NAME,
							  DESCRIPTION,
							  FORM_CONTENTS
							)
				    VALUES ( (SELECT NVL(MAX(FORM_ID), 0) + 1 FROM DOCUMENTFORM ),
				             #{formName},
				             #{description},
				             #{formContents}
				    )
	 -->
		insert into DOCUMENTS
			DOC_ID,
			EMP_NO,
			DOC_NO,
			DOC_TITLE,
			DOC_CONTENTS,
			REG_DATE,
			DONE_DATE,
			SECURE_LEVEL
		  values((select NVL(MAX(DOC_ID), 0) + 1 FROM DOCUMENTS),
		  	#{empNo},
		  	#{docNo},
		  	#{docTitle},
		  	#{docContents},
		  	#{regDate},
		  	#{doneDate},
		  	#{secureLevel}
		   )
	</insert>
	<select id="getDocList" parameterType="com.weaving.biz.doc.DocVO"
		resultType="com.weaving.biz.doc.DocVO">
		SELECT 
			D.DOC_ID,
			E.EMP_NAME,
			D.DOC_NO,
			D.DOC_TITLE,
			D.REG_DATE,
			D.DONE_DATE,
			D.SECURE_LEVEL
		  FROM DOCUMENTS D JOIN EMPLOYEES E ON D.EMP_NO = E.EMP_NO
		    <where> 
		    		DONE_DATE IS NOT NULL AND SECURE_LEVEL BETWEEN #{secureLevel} AND 'C' ORDER BY D.REG_DATE DESC
	    	</where>
	</select>
</mapper>